# Tactical Memo App - Phase 1 仕様書

## 目次

1. [概要](#概要)
2. [コンセプト](#コンセプト)
3. [技術スタック](#技術スタック)
4. [データ構造](#データ構造)
5. [機能仕様](#機能仕様)
6. [UI/UX デザイン](#uiuxデザイン)
7. [開発ロードマップ](#開発ロードマップ)

---

## 概要

### プロダクト名

Footics

### ターゲットユーザー

- サッカー戦術に興味のあるファン
- サッカーを深く観戦したい人
- 試合中のメモや分析を残したい人

### 解決する課題

- 試合を見ながら戦術的なポイントを記録したいが、適切なツールがない
- 試合後に「あの場面どうだったか」を振り返りたいが記憶が曖昧
- 自分の分析を体系的に蓄積できない

### Phase 1 のゴール

リアルタイムで試合を見ながら、選手ごとのイベント(プレー)とコメントを素早く記録できる MVP を完成させる

---

## コンセプト

### コアバリュー

1. **素早さ**: 試合中でも 2 タップでイベント記録
2. **柔軟性**: 情報の段階的入力(とりあえず記録 → 後で詳細追加)
3. **視覚化**: フォーメーション配置で直感的に記録
4. **振り返り**: タイムライン形式で試合の流れを再現

### 差別化ポイント

- ファンタジーやマッチング機能を排除し、純粋な分析に特化
- テンプレート機能でコミュニティと知見を共有
- 既存アプリ(試合後評価)との連携可能性

---

## 技術スタック

### フロントエンド

- **Framework**: Next.js 15 (App Router)
- **言語**: TypeScript
- **UI Library**: React 19
- **スタイリング**: Tailwind CSS + shadcn/ui
- **状態管理**: Zustand (軽量で十分)
- **データベース**: IndexedDB (Dexie.js 使用)
- **アイコン**: Lucide React
- **バリデーション**: zod
- **Tailwind クラス結合**: tailwind-merge

### 開発ツール

- **パッケージマネージャー**: pnpm
- **リンター**: ESLint + Prettier
- **型チェック**: TypeScript strict mode

### なぜ IndexedDB か

| 項目           | localStorage | IndexedDB            |
| -------------- | ------------ | -------------------- |
| 容量           | 5-10MB       | 50MB 以上            |
| データ型       | 文字列のみ   | オブジェクト直接保存 |
| パフォーマンス | 同期処理     | 非同期処理           |
| 検索機能       | なし         | インデックス使用可   |
| 用途適性       | 小規模設定   | 大規模データ ✓       |

**結論**: 試合データ、イベントデータが蓄積されるため、IndexedDB を採用

---

## データ構造

### 1. Match (試合)

```typescript
interface Match {
  id: string; // UUID
  homeTeam: string;
  awayTeam: string;
  date: Date;
  venue?: string;
  templateId?: string; // 使用したテンプレート
  formation: string; // "4-2-3-1"
  phase: 'first-half' | 'second-half' | 'finished';
  elapsedTime: number; // 秒単位
  createdAt: Date;
  updatedAt: Date;
}
```

### 2. Player (選手)

```typescript
interface Player {
  id: string;
  matchId: string; // 紐づく試合
  number: number;
  name?: string; // 後から設定可能
  position: string; // "FW", "MF", "DF", "GK"
  x: number; // ピッチ上の座標(0-100%)
  y: number; // ピッチ上の座標(0-100%)
}
```

### 3. Event (イベント)

```typescript
interface Event {
  id: string;
  matchId: string;
  playerId?: string; // 未割当の場合null
  timestamp: number; // 試合開始からの秒数
  phase: 'first-half' | 'second-half';
  type: EventType;
  comment?: string;
  createdAt: Date;
}

type EventType =
  // ポジティブ
  | 'off-the-ball-run' // 裏抜け
  | 'key-pass' // キーパス
  | 'interception' // インターセプト
  | 'press-success' // プレス成功
  | 'dribble' // ドリブル突破
  | 'shot' // シュート
  | 'cross' // クロス
  // ネガティブ
  | 'mispass' // ミスパス
  | 'lost-duel' // デュエル負け
  | 'position-mistake' // ポジショニングミス
  | 'turnover' // ボールロスト
  // ニュートラル
  | 'formation-change' // フォーメーション変更
  | 'substitution' // 選手交代
  | 'tactical-note'; // 戦術メモ
```

### 4. Template (テンプレート)

```typescript
interface Template {
  id: string;
  name: string;
  formation: string;
  players: Omit<Player, 'id' | 'matchId'>[];
  kit: {
    primaryColor: string;
    secondaryColor: string;
    style: 'solid' | 'stripe' | 'half';
  };
  shared: boolean; // コミュニティ共有フラグ
  createdAt: Date;
}
```

### IndexedDB スキーマ (Dexie.js)

```typescript
class TacticalMemoDB extends Dexie {
  matches!: Table<Match>;
  players!: Table<Player>;
  events!: Table<Event>;
  templates!: Table<Template>;

  constructor() {
    super('TacticalMemoDB');
    this.version(1).stores({
      matches: 'id, date, homeTeam, awayTeam',
      players: 'id, matchId, number',
      events: 'id, matchId, playerId, timestamp',
      templates: 'id, name, shared',
    });
  }
}
```

---

## 機能仕様

### 1. タイマー機能

#### 1-1. クイックスタート

**画面**: ホーム画面

- 大きな「新規試合記録」ボタン
- タップでモーダル表示

**モーダル内容**:

```
┌─────────────────────┐
│ 試合記録を開始       │
├─────────────────────┤
│ □ テンプレートから  │
│ □ ゼロから開始      │
└─────────────────────┘
```

**テンプレート選択時**:

- テンプレート一覧表示
- 選択 → 即座に記録画面遷移(選手配置済み)

**ゼロから開始時**:

- 即座に記録画面遷移
- 後から選手追加可能

#### 1-2. タイマー表示

**位置**: 記録画面最上部
**表示形式**: `23:45` (分:秒)
**機能**:

- 再生/一時停止ボタン
- 前半(0:00-45:00) / 後半(45:00-90:00)切り替え
- ロスタイム手動追加(+1, +2...ボタン)
- 45 分経過時に「前半終了」通知

**実装メモ**:

```typescript
// Zustand store
interface TimerState {
  elapsedTime: number; // 秒
  isRunning: boolean;
  phase: 'first-half' | 'second-half';
  start: () => void;
  pause: () => void;
  switchPhase: () => void;
  addStoppage: (minutes: number) => void;
}
```

---

### 2. フォーメーション配置

#### 2-1. ピッチビュー

**画面**: 記録画面上部(タイマー下)
**表示**:

```
┌─────────────────────┐
│     ⚽ ←(攻撃方向)   │
│   ┌─────────┐       │
│   │    ●9   │       │ ← 選手アイコン
│   │  ●11 ●10│       │
│   │  ●8  ●5 │       │
│   │    ●4   │       │
│   └─────────┘       │
│                     │
│ [編集モード]        │
└─────────────────────┘
```

#### 2-2. 編集モード

**トグルボタン**: 画面右上
**ON 時の機能**:

- 選手アイコンをドラッグ&ドロップ
- アイコンタップ → 選手情報編集モーダル
  - 背番号入力
  - 名前入力(任意)
  - ポジション選択
- 「+」ボタンでピッチに選手追加

**プリセットフォーメーション**:

```
ドロップダウンメニュー:
- 4-3-3
- 4-2-3-1
- 3-5-2
- 3-4-3
- カスタム
```

選択すると選手が自動配置

#### 2-3. 選手アイコン仕様

**デザイン**:

- 円形、直径 40px
- 背景色: テンプレートの kit 色 or デフォルト青
- 中央に背番号(白文字)
- 選択時: 青いボーダー + パルスアニメーション

**状態**:

- 通常
- 選択中(ハイライト)
- 編集モード(ドラッグ可能)

---

### 3. イベント記録機能

#### 3-1. モード A: 選手 → イベント方式

**対象**: 選手情報が登録済みの試合

**画面構成**:

```
┌────────────────────┐
│ [タイマー]          │
│ [ピッチビュー]      │
├────────────────────┤
│ 選択中: Palmer #20 │ ← 選択状態表示
├────────────────────┤
│ クイックイベント:   │
│ ⚡裏抜け  🎯パス   │
│ 🛡️イン   ⚔️プレス  │
│ 🚀シュート 💨ドリブル│
│ ❌ミスパス 😞デュエル×│
├────────────────────┤
│ [💬 コメント追加]   │
└────────────────────┘
```

**操作フロー**:

1. ピッチ上の選手アイコンをタップ → 選択状態
2. イベントボタンをタップ → 即座に記録
3. (任意)コメント追加ボタンで詳細メモ入力
4. タイムラインに自動追加

**イベント種別と色**:
| カテゴリ | イベント | 色 | アイコン |
|----------|----------|-----|---------|
| ポジティブ | 裏抜け | 青 | ⚡ |
| ポジティブ | キーパス | 青 | 🎯 |
| 守備 | インターセプト | 緑 | 🛡️ |
| 守備 | プレス成功 | 緑 | ⚔️ |
| 攻撃 | シュート | 黄 | 🚀 |
| ネガティブ | ミスパス | 赤 | ❌ |
| ネガティブ | デュエル負け | 赤 | 😞 |

#### 3-2. モード B: イベント先行方式

**対象**: 選手未登録 or 素早く記録したい時

**画面構成**:

```
┌────────────────────┐
│ イベントを記録:     │
├────────────────────┤
│ ⚡裏抜け  🎯パス   │
│ 🛡️イン   ⚔️プレス  │
│ (全イベント表示)    │
├────────────────────┤
│ [💬 コメント(任意)] │
├────────────────────┤
│ [記録する]          │
└────────────────────┘
```

**操作フロー**:

1. イベントタイプを選択
2. コメント入力(任意)
3. [記録する]ボタンタップ
4. タイムラインに「未割当」として追加

**後から割当**:

```
タイムライン表示:
23:45 | (未割当) | ⚡裏抜け | 💬「完璧なタイミング」
        ↓ タップ
割当モーダル:
┌────────────────────┐
│ 選手を選択:         │
│ □ Palmer #20       │
│ □ Enzo #8          │
│ □ 新しい選手を追加  │
└────────────────────┘
```

#### 3-3. モード切り替え

**位置**: 画面上部、タイマー横
**表示**: トグルスイッチ

```
[選手選択 | イベント先行]
```

#### 3-4. 未割当イベント一括編集

**トリガー**: 試合終了時 or 手動で「未割当を編集」
**画面**:

```
┌────────────────────┐
│ 未割当: 12件        │
├────────────────────┤
│ 23:45 ⚡裏抜け      │
│ → [選手を選択▼]    │
├────────────────────┤
│ 21:30 🎯キーパス   │
│ → [選手を選択▼]    │
├────────────────────┤
│ [スキップ] [完了]  │
└────────────────────┘
```

---

### 4. タイムライン表示

#### 4-1. 縦棒 UI

**画面**: 記録画面下部(スクロール可能)

**表示形式**:

```
┌──────────────────────┐
│ 45:00 ●──────────────│ ⚽ゴール
│   │   Palmer #20     │
│   │   「完璧な裏抜けから」│
│   │                  │
│ 38:12 ●──────────────│ 🎯キーパス
│   │   Enzo #8        │
│   │                  │
│ 23:45 ●──────────────│ 🛡️インターセプト
│   │   Caicedo #25    │
│   │   「読みが素晴らしい」│
│   │                  │
│ 12:30 ●──────────────│ ❌ミスパス
│   │   James #24      │
│   │                  │
│   ●                  │
│   │                  │
│ 00:00 ●──────────────│ 🟢キックオフ
└──────────────────────┘
```

**仕様**:

- **左側縦棒**: 4px 幅、青色(`#00d4ff`)
- **● マーク**: イベント種別で色分け
  - 青系: ポジティブ
  - 緑系: 守備
  - 赤系: ネガティブ
  - グレー: ニュートラル
- **時刻表示**: `MM:SS`形式
- **選手情報**: 名前 + 背番号 or 背番号のみ or (未割当)
- **コメント**: イベント名の下に斜体で表示

#### 4-2. セクション分割

```
┌──────────────────────┐
│ === 後半 45:00 ===   │
│ (イベント一覧)        │
│                      │
│ === ハーフタイム ===  │
│                      │
│ === 前半 45:00 ===   │
│ (イベント一覧)        │
│                      │
│ === キックオフ 00:00 ===│
└──────────────────────┘
```

#### 4-3. インタラクション

**タップ**:

- イベントカードをタップ → 編集ドロワー表示
  - 選手変更
  - イベントタイプ変更
  - コメント編集
  - 削除ボタン

**長押し**:

- 削除確認モーダル表示

**スワイプ**(将来):

- 左スワイプ → 削除
- 右スワイプ → 編集

---

### 5. テンプレート機能

#### 5-1. テンプレート管理画面

**アクセス**: ホーム画面の「テンプレート管理」

**画面構成**:

```
┌─────────────────────┐
│ マイテンプレート     │
├─────────────────────┤
│ ┌─────────────┐     │
│ │ Chelsea Home│     │
│ │ 4-2-3-1     │ [✏️]│
│ │ 11選手      │ [🗑️]│
│ │ #034694     │     │
│ └─────────────┘     │
│                     │
│ ┌─────────────┐     │
│ │ Chelsea Away│     │
│ │ 4-3-3       │ [✏️]│
│ │ 11選手      │ [🗑️]│
│ └─────────────┘     │
│                     │
│ [+ 新規作成]        │
│ [📥 インポート]     │
└─────────────────────┘
```

#### 5-2. テンプレート作成

**トリガー**:

1. 「新規作成」ボタン
2. 試合終了後「テンプレートとして保存」

**編集画面**:

```
┌─────────────────────┐
│ テンプレート名:      │
│ [Chelsea 2024/25]   │
├─────────────────────┤
│ フォーメーション:    │
│ [4-2-3-1 ▼]        │
├─────────────────────┤
│ [ピッチビュー]      │
│ (選手配置編集)       │
├─────────────────────┤
│ ユニフォーム設定:    │
│ 基本色: [🎨#034694] │
│ 副色:   [🎨#FFFFFF] │
│ スタイル: [縞 ▼]    │
├─────────────────────┤
│ [保存] [キャンセル]  │
└─────────────────────┘
```

#### 5-3. インポート/エクスポート(Phase 1.5)

**エクスポート**:

```json
// template_chelsea_home.json
{
  "version": "1.0",
  "template": {
    "name": "Chelsea Home 24/25",
    "formation": "4-2-3-1",
    "players": [...],
    "kit": {...}
  }
}
```

**インポート方法**:

1. JSON ファイルアップロード
2. 将来: コミュニティからブラウズ&インストール

---

### 6. 試合管理

#### 6-1. 試合一覧

**画面**: ホーム画面

**表示**:

```
┌─────────────────────┐
│ 最近の試合          │
├─────────────────────┤
│ ┌─────────────┐     │
│ │ CHE 2-1 ARS │ [▶] │
│ │ 2025/11/01  │     │
│ │ 32 events   │     │
│ └─────────────┘     │
│                     │
│ ┌─────────────┐     │
│ │ CHE 3-0 TOT │ [▶] │
│ │ 2025/10/25  │     │
│ │ 28 events   │     │
│ └─────────────┘     │
└─────────────────────┘
```

#### 6-2. 試合詳細

**アクセス**: 試合カードをタップ

**画面**:

```
┌─────────────────────┐
│ Chelsea 2-1 Arsenal │
│ 2025/11/01          │
│ Stamford Bridge     │
├─────────────────────┤
│ [タイムラインを見る] │
│ [統計を見る]        │
│ [編集を続ける]      │
│ [エクスポート]      │
│ [削除]              │
└─────────────────────┘
```

#### 6-3. 統計画面(Phase 1.5)

**表示内容**:

- 選手別イベント集計
  - Palmer: キーパス 5 回、ミスパス 2 回
- イベントタイプ分布(円グラフ)
- 時間帯別イベント数(棒グラフ)
- コメントワードクラウド

---
